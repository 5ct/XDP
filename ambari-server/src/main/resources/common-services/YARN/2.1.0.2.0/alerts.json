{
  "MAPREDUCE2": {
    "service": [],
    "HISTORYSERVER": [
      {
        "name": "mapreduce_history_server_webui",
        "label": "History Server Web UI",
        "description": "如果历史服务器Web用户界面不可访问，则触发此主机级警报。",
        "interval": 1,
        "scope": "ANY",
        "source": {
          "type": "WEB",
          "uri": {
            "http": "{{mapred-site/mapreduce.jobhistory.webapp.address}}",
            "https": "{{mapred-site/mapreduce.jobhistory.webapp.https.address}}",
            "https_property": "{{mapred-site/mapreduce.jobhistory.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "kerberos_keytab": "{{mapred-site/mapreduce.jobhistory.webapp.spnego-keytab-file}}",
            "kerberos_principal": "{{mapred-site/mapreduce.jobhistory.webapp.spnego-principal}}",
            "connection_timeout": 5.0
          },
          "reporting": {
            "ok": {
              "text": "HTTP {0} response in {2:.3f}s"
            },
            "warning":{
              "text": "HTTP {0} response from {1} in {2:.3f}s ({3})"
            },
            "critical": {
              "text": "Connection failed to {1} ({3})"
            }
          }
        }
      },
      {
        "name": "mapreduce_history_server_cpu",
        "label": "History Server CPU Utilization",
        "description": "如果历史服务器上的CPU利用率超过了配置的临界阈值，则触发此主机级警报。阈值设置为百分比。",
        "interval": 5,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{mapred-site/mapreduce.jobhistory.webapp.address}}",
            "kerberos_keytab": "{{mapred-site/mapreduce.jobhistory.webapp.spnego-keytab-file}}",
            "kerberos_principal": "{{mapred-site/mapreduce.jobhistory.webapp.spnego-principal}}",
            "https": "{{mapred-site/mapreduce.jobhistory.webapp.https.address}}",
            "https_property": "{{mapred-site/mapreduce.jobhistory.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "connection_timeout": 5.0
          },
          "reporting": {
            "ok": {
              "text": "{1} CPU, load {0:.1%}"
            },
            "warning": {
              "text": "{1} CPU, load {0:.1%}",
              "value": 200
            },
            "critical": {
              "text": "{1} CPU, load {0:.1%}",
              "value": 250
            },
            "units" : "%",
            "type": "PERCENT"
          },
          "jmx": {
            "property_list": [
              "java.lang:type=OperatingSystem/SystemCpuLoad",
              "java.lang:type=OperatingSystem/AvailableProcessors"
            ],
            "value": "{0} * 100"
          }
        }
      },
      {
        "name": "mapreduce_history_server_rpc_latency",
        "label": "History Server RPC Latency",
        "description": "如果历史服务器操作RPC延迟超过配置的临界阈值，则触发此主机级警报。通常，RPC处理时间的增加会增加RPC队列长度，从而导致操作的平均队列等待时间增加。阈值以毫秒为单位。",
        "interval": 5,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{mapred-site/mapreduce.jobhistory.webapp.address}}",
            "https": "{{mapred-site/mapreduce.jobhistory.webapp.https.address}}",
            "kerberos_keytab": "{{mapred-site/mapreduce.jobhistory.webapp.spnego-keytab-file}}",
            "kerberos_principal": "{{mapred-site/mapreduce.jobhistory.webapp.spnego-principal}}",
            "https_property": "{{mapred-site/mapreduce.jobhistory.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "connection_timeout": 5.0
          },
          "reporting": {
            "ok": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]"
            },
            "warning": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]",
              "value": 3000
            },          
            "critical": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]",
              "value": 5000
            },
            "units" : "ms"
          },
          "jmx": {
            "property_list": [
              "Hadoop:service=JobHistoryServer,name=RpcActivityForPort*/RpcQueueTimeAvgTime",
              "Hadoop:service=JobHistoryServer,name=RpcActivityForPort*/RpcProcessingTimeAvgTime"
            ],
            "value": "{0}"
          }
        }
      },
      {
        "name": "mapreduce_history_server_process",
        "label": "History Server Process",
        "description": "如果无法建立历史服务器进程，则会触发此主机级警报。",
        "interval": 1,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "PORT",
          "uri": "{{mapred-site/mapreduce.jobhistory.webapp.address}}",
          "default_port": 19888,
          "reporting": {
            "ok": {
              "text": "TCP OK - {0:.3f}s response on port {1}"
            },
            "warning": {
              "text": "TCP OK - {0:.3f}s response on port {1}",
              "value": 1.5
            },
            "critical": {
              "text": "Connection failed: {0} to {1}:{2}",
              "value": 5.0
            }
          }
        }
      }
    ]
  },
  "YARN": {
    "service": [
      {
        "name": "yarn_nodemanager_webui_percent",
        "label": "Percent NodeManagers Available",
        "description": "这个警告是如果集群中的NodeManagers数大于设定的阈值触发。它聚集nodemanager过程检查结果。",
        "interval": 1,
        "scope": "SERVICE",
        "enabled": true,
        "source": {
          "type": "AGGREGATE",
          "alert_name": "yarn_nodemanager_webui",
          "reporting": {
            "ok": {
              "text": "affected: [{1}], total: [{0}]"
            },
            "warning": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 10
            },
            "critical": {
              "text": "affected: [{1}], total: [{0}]",
              "value": 30
            },
            "units" : "%",
            "type": "PERCENT"
          }
        }
      }
    ],
    "NODEMANAGER": [
      {
        "name": "yarn_nodemanager_webui",
        "label": "NodeManager Web UI",
        "description": "如果无法获取Nodemanager Web UI则触发这个主机级别的警报。",
        "interval": 1,
        "scope": "HOST",
        "source": {
          "type": "WEB",
          "uri": {
            "http": "{{yarn-site/yarn.nodemanager.webapp.address}}",
            "https": "{{yarn-site/yarn.nodemanager.webapp.https.address}}",
            "https_property": "{{yarn-site/yarn.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "default_port": 8042,
            "kerberos_keytab": "{{yarn-site/yarn.nodemanager.webapp.spnego-keytab-file}}",
            "kerberos_principal": "{{yarn-site/yarn.nodemanager.webapp.spnego-principal}}",
            "connection_timeout": 5.0
          },
          "reporting": {
            "ok": {
              "text": "HTTP {0} response in {2:.3f}s"
            },
            "warning":{
              "text": "HTTP {0} response from {1} in {2:.3f}s ({3})"
            },
            "critical": {
              "text": "Connection failed to {1} ({3})"
            }
          }
        }
      },
      {
        "name": "yarn_nodemanager_health",
        "label": "NodeManager Health",
        "description": "这个主机级别的警报检查节点的健康属性可以从nodemanager组件。",
        "interval": 1,
        "scope": "HOST",
        "enabled": true,
        "source": {
          "type": "SCRIPT",
          "path": "YARN/2.1.0.2.0/package/alerts/alert_nodemanager_health.py",
          "parameters": [
            {
              "name": "connection.timeout",
              "display_name": "Connection Timeout",
              "value": 5.0,
              "type": "NUMERIC",
              "description": "此警告被认为是CRITICAL之前所经历的最大时间",
              "units": "seconds",
              "threshold": "CRITICAL"
            }
          ]
        }
      }
    ],
    "RESOURCEMANAGER": [
      {
        "name": "yarn_resourcemanager_webui",
        "label": "ResourceManager Web UI",
        "description": "如果无法获取ResourceManager Web UI则触发这个主机级别的警报。",
        "interval": 1,
        "scope": "ANY",
        "source": {
          "type": "WEB",
          "uri": {
            "http": "{{yarn-site/yarn.resourcemanager.webapp.address}}",
            "https": "{{yarn-site/yarn.resourcemanager.webapp.https.address}}",
            "https_property": "{{yarn-site/yarn.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "kerberos_keytab": "{{yarn-site/yarn.resourcemanager.webapp.spnego-keytab-file}}",
            "kerberos_principal": "{{yarn-site/yarn.resourcemanager.webapp.spnego-principal}}",
            "connection_timeout": 5.0,
            "high_availability": {
              "alias_key" : "{{yarn-site/yarn.resourcemanager.ha.rm-ids}}",
              "http_pattern" : "{{yarn-site/yarn.resourcemanager.webapp.address.{{alias}}}}",
              "https_pattern" : "{{yarn-site/yarn.resourcemanager.webapp.https.address.{{alias}}}}"
            }
          },
          "reporting": {
            "ok": {
              "text": "HTTP {0} response in {2:.3f}s"
            },
            "warning":{
              "text": "HTTP {0} response from {1} in {2:.3f}s ({3})"
            },
            "critical": {
              "text": "Connection failed to {1} ({3})"
            }
          }
        }
      },
      {
        "name": "yarn_resourcemanager_cpu",
        "label": "ResourceManager CPU Utilization",
        "description": "这个主机级别的警报如果ResourceManager的CPU利用率超过一定的临界阈值触发预警。它检查的systemcpuload财产ResourceManager JMX servlet。阈值设置为百分比。",
        "interval": 5,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{yarn-site/yarn.resourcemanager.webapp.address}}",
            "https": "{{yarn-site/yarn.resourcemanager.webapp.https.address}}",
            "kerberos_keytab": "{{yarn-site/yarn.resourcemanager.webapp.spnego-keytab-file}}",
            "kerberos_principal": "{{yarn-site/yarn.resourcemanager.webapp.spnego-principal}}",
            "https_property": "{{yarn-site/yarn.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "connection_timeout": 5.0,
            "high_availability": {
              "alias_key" : "{{yarn-site/yarn.resourcemanager.ha.rm-ids}}",
              "http_pattern" : "{{yarn-site/yarn.resourcemanager.webapp.address.{{alias}}}}",
              "https_pattern" : "{{yarn-site/yarn.resourcemanager.webapp.https.address.{{alias}}}}"
            }
          },
          "reporting": {
            "ok": {
              "text": "{1} CPU, load {0:.1%}"
            },
            "warning": {
              "text": "{1} CPU, load {0:.1%}",
              "value": 200
            },
            "critical": {
              "text": "{1} CPU, load {0:.1%}",
              "value": 250
            },
            "units" : "%",
            "type": "PERCENT"
          },
          "jmx": {
            "property_list": [
              "java.lang:type=OperatingSystem/SystemCpuLoad",
              "java.lang:type=OperatingSystem/AvailableProcessors"
            ],
            "value": "{0} * 100"
          }
        }
      },
      {
        "name": "yarn_resourcemanager_rpc_latency",
        "label": "ResourceManager RPC Latency",
        "description": "这个主机级别的警报如果ResourceManager操作RPC延迟超过临界阈值触发配置。通常在RPC处理时间增加，RPC排队长度，使平均排队等待时间增加ResourceManager操作。阈值以毫秒为单位。",
        "interval": 5,
        "scope": "ANY",
        "enabled": true,
        "source": {
          "type": "METRIC",
          "uri": {
            "http": "{{yarn-site/yarn.resourcemanager.webapp.address}}",
            "https": "{{yarn-site/yarn.resourcemanager.webapp.https.address}}",
            "kerberos_keytab": "{{yarn-site/yarn.resourcemanager.webapp.spnego-keytab-file}}",
            "kerberos_principal": "{{yarn-site/yarn.resourcemanager.webapp.spnego-principal}}",
            "https_property": "{{yarn-site/yarn.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "connection_timeout": 5.0,
            "high_availability": {
              "alias_key" : "{{yarn-site/yarn.resourcemanager.ha.rm-ids}}",
              "http_pattern" : "{{yarn-site/yarn.resourcemanager.webapp.address.{{alias}}}}",
              "https_pattern" : "{{yarn-site/yarn.resourcemanager.webapp.https.address.{{alias}}}}"
            }
          },
          "reporting": {
            "ok": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]"
            },
            "warning": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]",
              "value": 3000
            },          
            "critical": {
              "text": "Average Queue Time:[{0}], Average Processing Time:[{1}]",
              "value": 5000
            },
            "units" : "ms"
          },
          "jmx": {
            "property_list": [
              "Hadoop:service=ResourceManager,name=RpcActivityForPort*/RpcQueueTimeAvgTime",
              "Hadoop:service=ResourceManager,name=RpcActivityForPort*/RpcProcessingTimeAvgTime"
            ],
            "value": "{0}"
          }
        }
      },
      {
        "name": "nodemanager_health_summary",
        "label": "NodeManager Health Summary",
        "description": "如果有不健康的nodemanagers则触发这个服务级警告",
        "interval": 1,
        "scope": "SERVICE",
        "enabled": true,
        "source": {
          "type": "SCRIPT",
          "path": "YARN/2.1.0.2.0/package/alerts/alert_nodemanagers_summary.py",
          "parameters": [
            {
              "name": "connection.timeout",
              "display_name": "Connection Timeout",
              "value": 5.0,
              "type": "NUMERIC",
              "description": "此警告被认为是CRITICAL之前所经历的最大时间",
              "units": "seconds",
              "threshold": "CRITICAL"
            }
          ]
        }
      }
    ],
    "APP_TIMELINE_SERVER": [
      {
        "name": "yarn_app_timeline_server_webui",
        "label": "App Timeline Web UI",
        "description": "如果应用程序时间服务器Web用户界面无法访问，则触发此主机级警报。",
        "interval": 1,
        "scope": "ANY",
        "source": {
          "type": "WEB",
          "uri": {
            "http": "{{yarn-site/yarn.timeline-service.webapp.address}}/ws/v1/timeline",
            "https": "{{yarn-site/yarn.timeline-service.webapp.https.address}}/ws/v1/timeline",
            "https_property": "{{yarn-site/yarn.http.policy}}",
            "https_property_value": "HTTPS_ONLY",
            "kerberos_keytab": "{{yarn-site/yarn.timeline-service.http-authentication.kerberos.keytab}}",
            "kerberos_principal": "{{yarn-site/yarn.timeline-service.http-authentication.kerberos.principal}}",
            "connection_timeout": 5.0
          },
          "reporting": {
            "ok": {
              "text": "HTTP {0} response in {2:.3f}s"
            },
            "warning":{
              "text": "HTTP {0} response from {1} in {2:.3f}s ({3})"
            },
            "critical": {
              "text": "Connection failed to {1} ({3})"
            }
          }
        }
      }
    ]
  }
}
